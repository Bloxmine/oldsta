<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oldstagram | Classic filters</title>
    <link rel="stylesheet" href="dist/instagram.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1>Oldstagram</h1>
    </div>
    <div class="container">
        <p>Welcome to Oldstagram! Here you can apply classic filters to your photos.</p>
        <form id="upload-form" enctype="multipart/form-data">
            <input type="file" id="image-input" accept="image/*" required>
            <button type="submit">Upload</button>
        </form>
        <div id="filters">
            <label for="filter-select">Choose a filter:</label>
            <select id="filter-select">
                <option value="filter-1977">1977</option>
                <option value="filter-aden">Aden</option>
                <option value="filter-amaro">Amaro</option>
                <option value="filter-ashby">Ashby</option>
                <option value="filter-brannan">Brannan</option>
                <option value="filter-brooklyn">Brooklyn</option>
                <option value="filter-charmes">Charmes</option>
                <option value="filter-clarendon">Clarendon</option>
                <option value="filter-crema">Crema</option>
                <option value="filter-dogpatch">Dogpatch</option>
                <option value="filter-earlybird">Earlybird</option>
                <option value="filter-gingham">Gingham</option>
                <option value="filter-ginza">Ginza</option>
                <option value="filter-hefe">Hefe</option>
                <option value="filter-helena">Helena</option>
                <option value="filter-hudson">Hudson</option>
                <option value="filter-inkwell">Inkwell</option>
                <option value="filter-kelvin">Kelvin</option>
                <option value="filter-juno">Kuno</option>
                <option value="filter-lark">Lark</option>
                <option value="filter-lofi">Lo-Fi</option>
                <option value="filter-ludwig">Ludwig</option>
                <option value="filter-maven">Maven</option>
                <option value="filter-mayfair">Mayfair</option>
                <option value="filter-moon">Moon</option>
                <option value="filter-nashville">Nashville</option>
                <option value="filter-perpetua">Perpetua</option>
                <option value="filter-poprocket">Poprocket</option>
                <option value="filter-reyes">Reyes</option>
                <option value="filter-rise">Rise</option>
                <option value="filter-sierra">Sierra</option>
                <option value="filter-skyline">Skyline</option>
                <option value="filter-slumber">Slumber</option>
                <option value="filter-stinson">Stinson</option>
                <option value="filter-sutro">Sutro</option>
                <option value="filter-toaster">Toaster</option>
                <option value="filter-valencia">Valencia</option>
                <option value="filter-vesper">Vesper</option>
                <option value="filter-walden">Walden</option>
                <option value="filter-willow">Willow</option>
                <option value="filter-xpro-ii">X-Pro II</option>
            </select>
        </div>
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <button id="download-button">Download Filtered Image</button>
    </div>
</body>
<script>
    const uploadForm = document.getElementById('upload-form');
    const imageInput = document.getElementById('image-input');
    const canvas = document.getElementById('canvas');
    const canvasContainer = document.getElementById('canvas-container');
    const filterSelect = document.getElementById('filter-select');
    const ctx = canvas.getContext('2d');
    let currentImage = null; // Store the uploaded image

    // Apply the selected filter to the canvas container
    filterSelect.addEventListener('change', () => {
        const selectedFilter = filterSelect.value;

        // Remove any existing filter classes
        canvasContainer.className = '';
        // Add the selected filter class
        canvasContainer.classList.add(selectedFilter);

        // Redraw the image with the filter applied
        if (currentImage) {
            applyFilterAndRedraw();
        }
    });

    uploadForm.addEventListener('submit', (event) => {
        event.preventDefault(); // Prevent form submission

        const file = imageInput.files[0];
        if (file) {
            const reader = new FileReader();

            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // Store the uploaded image
                    currentImage = img;

                    // Resize canvas to match the image dimensions
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Draw the image onto the canvas
                    applyFilterAndRedraw();
                };
                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        } else {
            alert('Please select an image to upload.');
        }
    });

    const downloadButton = document.getElementById('download-button');

    downloadButton.addEventListener('click', () => {
        if (!currentImage) {
            alert('Please upload an image first.');
            return;
        }

        // Create a temporary link element
        const link = document.createElement('a');
        link.download = 'filtered-image.png'; // Set the file name
        link.href = canvas.toDataURL('image/png'); // Convert canvas to a data URL
        link.click(); // Trigger the download
    });

    function applyFilterAndRedraw() {
        // Get the selected filter
        const selectedFilter = getComputedStyle(canvasContainer).filter;

        // Apply the filter to the canvas context
        ctx.filter = selectedFilter;

        // Clear the canvas and redraw the image with the filter
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(currentImage, 0, 0);

        // Reset the filter for future operations
        ctx.filter = 'none';
    }
</script>
</html>